<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blood Request Details - Blood Donation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-100">
    <div class="min-h-screen py-8">
      <div class="max-w-4xl mx-auto px-4">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <a
              href="/receiver-dashboard"
              class="text-gray-600 hover:text-gray-800 mr-4"
            >
              <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-2xl font-bold text-gray-800">
              Blood Request Details
            </h1>
          </div>
          <div class="flex items-center space-x-4">
            <span
              class="px-3 py-1 text-sm font-semibold rounded-full {% if blood_request.urgency == 'Critical' %}text-red-800 bg-red-100 {% elif blood_request.urgency == 'High' %}text-orange-800 bg-orange-100 {% else %}text-blue-800 bg-blue-100{% endif %}"
            >
              {{ blood_request.urgency }} Priority
            </span>
          </div>
        </div>

        <!-- Request Information Card -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <h2 class="text-xl font-semibold text-gray-800 mb-4">
                Request Information
              </h2>
              <div class="space-y-3">
                <div>
                  <p class="text-sm text-gray-600">Blood Group Needed</p>
                  <p class="text-lg font-semibold text-red-600">
                    {{ blood_request.blood_group_needed }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Quantity Required</p>
                  <p class="font-medium">{{ blood_request.quantity_needed }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Request Date</p>
                  <p class="font-medium">
                    {{ blood_request.request_date.strftime('%B %d, %Y at %I:%M
                    %p') }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Needed By</p>
                  <p class="font-medium text-orange-600">
                    {{ blood_request.needed_by_date.strftime('%B %d, %Y') }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Status</p>
                  <span
                    class="px-2 py-1 text-xs font-semibold rounded-full {% if blood_request.status == 'Active' %}text-green-800 bg-green-100 {% elif blood_request.status == 'Fulfilled' %}text-blue-800 bg-blue-100 {% else %}text-gray-800 bg-gray-100{% endif %}"
                  >
                    {{ blood_request.status }}
                  </span>
                </div>
              </div>
            </div>

            <div>
              <h2 class="text-xl font-semibold text-gray-800 mb-4">
                Hospital Information
              </h2>
              <div class="space-y-3">
                <div>
                  <p class="text-sm text-gray-600">Hospital Name</p>
                  <p class="font-medium">{{ blood_request.hospital_name }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Hospital Location</p>
                  <p class="font-medium">
                    {{ blood_request.hospital_location }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Contact Person</p>
                  <p class="font-medium">{{ blood_request.contact_person }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Contact Number</p>
                  <p class="font-medium">
                    <i class="fas fa-phone mr-1 text-gray-400"></i>
                    {{ blood_request.contact_number }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {% if blood_request.additional_notes %}
          <div class="mt-6 pt-6 border-t border-gray-200">
            <h3 class="text-lg font-medium text-gray-800 mb-2">
              Additional Notes
            </h3>
            <div class="bg-gray-50 rounded-lg p-4">
              <p class="text-gray-700">{{ blood_request.additional_notes }}</p>
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Donor Responses -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-semibold text-gray-800">
              Donor Responses ({{ responses|length }})
            </h2>
            <div class="text-sm text-gray-500">
              <i class="fas fa-clock mr-1"></i>
              Last updated: {{ responses[0].response_date.strftime('%m/%d/%Y at
              %I:%M %p') if responses else 'No responses yet' }}
            </div>
          </div>

          {% if responses %}
          <div class="space-y-4">
            {% for response in responses %}
            <div
              class="border border-gray-200 rounded-lg p-4 {% if response.status == 'Confirmed' %}border-blue-300 bg-blue-50 {% elif response.status == 'Accepted' %}border-green-300 bg-green-50{% endif %}"
            >
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <div
                      class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center"
                    >
                      <i class="fas fa-user text-red-600"></i>
                    </div>
                    <div>
                      <h3 class="font-semibold text-gray-800">
                        {{ response.donor.name }}
                      </h3>
                      <p class="text-sm text-gray-600">
                        Blood Group: {{ response.donor.blood_group }} • Age: {{
                        response.donor.age }} • {{ response.donor.gender }}
                      </p>
                    </div>
                  </div>

                  <div class="ml-13">
                    <p class="text-sm text-gray-600 mb-1">
                      <i class="fas fa-map-marker-alt mr-1"></i>{{
                      response.donor.location }}
                    </p>
                    <p class="text-sm text-gray-600 mb-2">
                      <i class="fas fa-phone mr-1"></i>{{ response.donor.contact
                      }}
                    </p>
                    <p class="text-xs text-gray-500">
                      Available for donation:
                      <span
                        class="{% if response.donor.availability %}text-green-600{% else %}text-red-600{% endif %}"
                      >
                        {% if response.donor.availability %}Yes{% else %}No{%
                        endif %}
                      </span>
                    </p>
                  </div>
                </div>

                <div class="text-right ml-4">
                  <span
                    class="px-3 py-1 text-sm font-semibold rounded-full {% if response.status == 'Accepted' %}text-green-800 bg-green-100 {% elif response.status == 'Rejected' %}text-red-800 bg-red-100 {% elif response.status == 'Confirmed' %}text-blue-800 bg-blue-100 {% elif response.status == 'Completed' %}text-purple-800 bg-purple-100 {% elif response.status == 'Declined' %}text-gray-800 bg-gray-100 {% elif response.status == 'Cancelled' %}text-red-800 bg-red-100 {% else %}text-yellow-800 bg-yellow-100{% endif %}"
                  >
                    {{ response.status }}
                  </span>
                  <p class="text-xs text-gray-500 mt-1">
                    {{ response.response_date.strftime('%m/%d/%Y') }}<br />
                    {{ response.response_date.strftime('%I:%M %p') }}
                  </p>
                </div>
              </div>

              <!-- Donor's Message -->
              {% if response.donor_notes %}
              <div class="mb-3 p-3 bg-white rounded border">
                <p class="text-xs text-gray-600 mb-1 font-medium">
                  <i class="fas fa-comment mr-1"></i>Donor's Message:
                </p>
                <p class="text-sm text-gray-800">{{ response.donor_notes }}</p>
              </div>
              {% endif %}

              <!-- Receiver's Response -->
              {% if response.receiver_notes %}
              <div class="mb-3 p-3 bg-blue-50 rounded border border-blue-200">
                <p class="text-xs text-blue-600 mb-1 font-medium">
                  <i class="fas fa-reply mr-1"></i>Your Response:
                </p>
                <p class="text-sm text-blue-800">
                  {{ response.receiver_notes }}
                </p>
              </div>
              {% endif %}

              <!-- Action Buttons -->
              {% if response.status == 'Accepted' and blood_request.status ==
              'Active' %}
              <div class="flex gap-3 pt-3 border-t border-gray-200">
                <form
                  method="POST"
                  action="/manage-donor-response/{{ response.id }}"
                  class="flex-1"
                >
                  <input type="hidden" name="action" value="confirm" />
                  <div class="mb-2">
                    <input
                      type="text"
                      name="notes"
                      placeholder="Add a note (optional)"
                      class="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  <button
                    type="submit"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors"
                  >
                    <i class="fas fa-handshake mr-2"></i>Confirm This Donor
                  </button>
                </form>

                <form
                  method="POST"
                  action="/manage-donor-response/{{ response.id }}"
                  class="flex-1"
                >
                  <input type="hidden" name="action" value="decline" />
                  <div class="mb-2">
                    <input
                      type="text"
                      name="notes"
                      placeholder="Reason for declining (optional)"
                      class="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                    />
                  </div>
                  <button
                    type="submit"
                    class="w-full bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600 transition-colors"
                  >
                    <i class="fas fa-times mr-2"></i>Decline Response
                  </button>
                </form>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-12">
            <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
            <h3 class="text-lg font-medium text-gray-600 mb-2">
              No Responses Yet
            </h3>
            <p class="text-gray-500">
              Donors who match your blood type will see your request and can
              respond.
            </p>
            <p class="text-sm text-gray-400 mt-2">
              Make sure your request has clear details to attract more donors.
            </p>
          </div>
          {% endif %}
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 mt-6">
          <a
            href="/receiver-dashboard"
            class="flex-1 bg-gray-600 text-white text-center py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors"
          >
            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
          </a>

          {% if blood_request.status == 'Active' %}
          <a
            href="/create-request"
            class="flex-1 bg-red-600 text-white text-center py-3 px-4 rounded-lg hover:bg-red-700 transition-colors"
          >
            <i class="fas fa-plus mr-2"></i>Create Another Request
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </body>
</html>
